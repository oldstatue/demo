<html>

<head>
<link rel="stylesheet" type="text/css" href="style.css" />
<title> CyberStevens </title>
</head>

<body>

<form>
	<input type="text" id="search-string"></input>
	<button onclick="filterPoems(document.getElementById('search-string').value)">Search</button>
</form>

<div id="title-list"></div>

<script type="text/javascript">

function filterPoems (input) {
	titleList.innerHTML = "";

	var regex = RegExp(input.toLowerCase());
	for (var p of poemList) {
		if (regex.test(p.title.toLowerCase())) {
			titleList.appendChild(p.html);
		}
	}
}

var titleList = document.getElementById('title-list');
var poemList = [];

var xmlReq = new XMLHttpRequest();
xmlReq.open("GET", "./log.xml", true);
xmlReq.send();

xmlReq.onload = function () {
	var xmlDoc = xmlReq.responseXML;
	var poems = xmlDoc.getElementsByTagName("poem");

	for (var i = 0; i < poems.length; i ++) {
		poemList.push({
			title: xmlDoc.getElementsByTagName("title")[i].childNodes[0].nodeValue,
			text: xmlDoc.getElementsByTagName("text")[i].childNodes[0].nodeValue,
		});
	}

	for (var p of poemList) {
		let newContainer = document.createElement('div');

		let newTitle = document.createElement('a');
		newTitle.innerHTML = p.title;
		newTitle.href = "#";
		newContainer.appendChild(newTitle);

		let textContainer = document.createElement('div');
		textContainer.id = "text-container";
		textContainer.style.height = "0px";
		newContainer.appendChild(textContainer);

		let newText = document.createElement('p');
		newText.innerHTML = p.text;
		newText.id = "poem-body";
		textContainer.appendChild(newText);

		newTitle.onclick = function () {
			var textEl = this.parentNode.querySelector("#text-container");

			if (textEl.style.height == "0px") {
				textEl.style.height = textEl.scrollHeight + "px";
			} else {
				textEl.style.height = "0px";
			}
		}

		p.html = newContainer;
	}

	for (var p of poemList) {
		titleList.appendChild(p.html);
	}
}

</script>

</body>

</html>



